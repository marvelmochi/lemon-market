<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lemon Market</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/reset.css" />

    <!-- ì›¹ í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Alumni+Sans+Pinstripe&family=Anton&family=Noto+Sans+KR:wght@500&family=Roboto:wght@500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="wrap">
      <!-- í—¤ë” -->
      <div id="header">
        <div id="logo">ğŸ‹</div>
        <div id="title">LEMON MARKET</div>
        <button id="menu-button">â˜°</button>
      </div>
      <!-- //í—¤ë” -->
      <!-- ë¡œê·¸ì¸ -->
      <div id="login" class="hidden">
        <div id="login-title">LEMON MARKET LOGIN</div>
        <form id="login-form">
          <div>
            <input required id="id-input" placeholder="ID" autocomplete="off" />
          </div>
          <div>
            <input
              required
              id="password-input"
              type="password"
              placeholder="PASSWORD"
              autocomplete="off"
            />
          </div>
          <div id="login-btn-container">
            <button id="login-btn">LOGIN</button>
            <button id="sign-btn">SIGN UP</button>
          </div>
        </form>
      </div>
      <!-- //ë¡œê·¸ì¸ -->
      <!-- ë©”ì¸ -->
      <div id="main">
        <!-- ìœ„ì¹˜ -->
        <div id="location">
          <div id="town"></div>
          <button id="location-btn">ğŸ”„</button>
        </div>
        <div id="map"></div>
        <!-- //ìœ„ì¹˜-->
      </div>
      <!-- //ë©”ì¸ -->
    </div>
    <script type="text/javascript" , src="./js/apiKey.js"></script>
    <script type="module" , src="./js/elements.js"></script>
    <script type="module" , src="./js/utils.js"></script>
    <script type="module" , src="./js/signUp.js"></script>
    <script type="module" , src="./js/login.js"></script>
    <script type="module" , src="./js/location.js"></script>
    <script id="script"></script>
    <!--<script>
      const APP_KEY = config.KAKAO_API_KEY;
      const API_SRC = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${APP_KEY}`;
      console.log(API_SRC);
      document.getElementById("script").src = API_SRC;
    </script>-->

    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ec5f9dfa66a3a6eb6a6850d5f29e1b6d&libraries=services"
    ></script>
    <script>
      const town = document.getElementById("town");
      const mapContainer = document.getElementById("map");
      const locationBtn = document.getElementById("location-btn");
      paintUserLocationOnMap();
      function paintUserLocationOnMap() {
        // geolocationì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©´
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            //console.log(lat, lon);

            const mapOption = {
              center: new kakao.maps.LatLng(lat, lon),
              level: 4,
            };

            const map = new kakao.maps.Map(mapContainer, mapOption);

            // ë§ˆì»¤ í‘œì‹œë¥¼ ìœ„í•œ ìœ„ì¹˜ ë³€ìˆ˜
            let userPosition = new kakao.maps.LatLng(lat, lon);
            displayMarker(map, userPosition);
            // ìœ ì € ìœ„ì¹˜ë¡œ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì„œ ìƒë‹¨ì— í‘œì‹œ
            searchAddrFromCoords(userPosition, displayInfo);
          });
        } else {
          alert("ì£„ì†¡í•©ë‹ˆë‹¤. geolocationì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      function displayMarker(map, userPosition) {
        const marker = new kakao.maps.Marker({
          map: map,
          position: userPosition,
        });
      }

      function searchAddrFromCoords(coords, callback) {
        // ì£¼ì†Œ -> ì¢Œí‘œ ë³€í™˜ ê°ì²´
        const geocoder = new kakao.maps.services.Geocoder();
        // ì¢Œí‘œë¡œ í–‰ì •ë™ ì£¼ì†Œ ì •ë³´ë¥¼ ìš”ì²­
        geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);
      }

      function displayInfo(result, status) {
        if (status === kakao.maps.services.Status.OK) {
          for (let i = 0; i < result.length; i++) {
            if (result[i].region_type === "H") {
              town.innerHTML = result[i].address_name;
              break;
            }
          }
        }
      }

      locationBtn.addEventListener("click", paintUserLocationOnMap);
    </script>
  </body>
</html>
